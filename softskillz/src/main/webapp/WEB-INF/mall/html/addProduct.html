<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>新增商品</title>
	
    <!-- 引入 jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
            integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
            crossorigin="anonymous"></script>
			<!-- 引入自定義 CSS 樣式表 -->
			<link rel="stylesheet" type="text/css" href="../css/style.css">		
			 <link rel="stylesheet" type="text/css" href="../css/styles3.css">
		
</head>

<body>
	<!-- header區塊 -->
	<div id="header"></div> 
	
	<div id="info" style="margin-top: 50px;">
	
    <form id="addProductForm" enctype="multipart/form-data">
        <!-- 商品分類名稱 -->
        <label for="productCategory">商品分類名稱:</label>
        <select id="productCategory" name="productCategory">
        </select>
        <br>
        <!-- 商品名稱 -->
        <label for="productName">商品名稱:</label>
        <input type="text" id="productName" name="productName" required>
        <br>
        <!-- 商品描述 -->
        <label for="productDescription">商品描述:</label>
        <textarea id="productDescription" name="productDescription" required></textarea>
        <br>
        <!-- 商品價格 -->
        <label for="productPrice">商品價格:</label>
        <input type="number" id="productPrice" name="productPrice" min="0" required>
        <br>
        <!-- 商品庫存 -->
        <label for="productStock">商品庫存:</label>
        <input type="number" id="productStock" name="productStock" min="0" required>
        <br>
        <!-- 目標受眾 -->
        <label for="productTargetAudience">目標受眾:</label>
        <input type="text" id="productTargetAudience" name="productTargetAudience">
        <br>
        <!-- 新增商品按鈕 -->
        <button id="addProductBtn" type="submit">新增商品</button>
    </form>
	</div>

	
	<!-- 引入 JavaScript 腳本 -->
	    <script src="../js/scripts.js"></script>
	    <script src="../js/utils.js"></script>
		
    <script>

		
		$(document).ready(function() {
		    // 填充商品分類下拉選單
		    function fetchProductCategories() {
		        $.get('/api/product-categories', function(data) {
		            const select = $('#productCategory');
		            data.forEach(category => {
		                select.append(new Option(category.productCategoryName, category.productCategoryId));
		            });
		        }).fail(function(xhr) {
		            console.error('Error fetching product categories:', xhr.status);
		        });
		    }
		
		    // 註冊表單提交事件
		    $('#addProductForm').on('submit', function(event) {
		        event.preventDefault();
		        const productData = {
		            productCategory: {
		                productCategoryId: $('#productCategory').val() // 取得選中的分類 ID
		            },
		            productName: $('#productName').val(),
		            productDescription: $('#productDescription').val(),
		            productPrice: parseInt($('#productPrice').val(), 10),
		            productStock: parseInt($('#productStock').val(), 10) === 0 ? null : parseInt($('#productStock').val(), 10),
		            productTargetAudience: $('#productTargetAudience').val(),
		        };
		
		        console.log(JSON.stringify(productData)); // 在控制台打印出發送的資料
		
		        $.ajax({
		            url: '/api/products',
		            type: 'POST',
		            contentType: 'application/json',
		            data: JSON.stringify(productData),
		            success: function(data) {
		                alert('商品新增成功');
		                console.log('Success:', data);
		                $('#addProductForm')[0].reset();
						window.location.href = "/mall/index"; 
		            },
		            error: function(xhr) {
		                alert('商品新增失敗: ' + xhr.status);
		                console.error('Error:', xhr.responseText);
		            }
		        });
		    });
		
		    fetchProductCategories();
		});

		

    </script>
	<!-- 動態加載Header -->
	    <script>
	        fetch("/html/backtest.html")
	            .then(response => {
	                if (response.ok) {
	                    return response.text();
	                }
	            }).then(data => {
	                document.querySelector('#header').innerHTML = data;
	            })
	    </script>
</body>
</html>
