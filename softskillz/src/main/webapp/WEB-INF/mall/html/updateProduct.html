<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>修改商品</title>
	<!-- 引入 jQuery -->
	    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
	            integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
	            crossorigin="anonymous"></script>
				<!-- 引入自定義 CSS 樣式表 -->
				<link rel="stylesheet" type="text/css" href="../css/style.css">		
				 <link rel="stylesheet" type="text/css" href="../css/styles4.css">
</head>

<body>
	<!-- header區塊 -->
		<div id="header"></div> 
		
		<div id="info" style="margin-top: 50px;">
			
    <form id="updateProductForm" enctype="multipart/form-data">
        <!-- 商品編號 -->
        <input type="hidden" id="productId" name="productId">
        <!-- 商品名稱 -->
        <label for="productName">商品名稱:</label>
        <input type="text" id="productName" name="productName" required>
        <br>
        <!-- 商品描述 -->
        <label for="productDescription">商品描述:</label>
        <textarea id="productDescription" name="productDescription" required></textarea>
        <br>
        <!-- 商品價格 -->
        <label for="productPrice">商品價格:</label>
        <input type="number" id="productPrice" name="productPrice" min="0" required>
        <br>
        <!-- 商品庫存 -->
        <label for="productStock">商品庫存:</label>
        <input type="number" id="productStock" name="productStock" min="0" required>
        <br>
        <!-- 目標受眾 -->
        <label for="productTargetAudience">目標受眾:</label>
        <input type="text" id="productTargetAudience" name="productTargetAudience">
        <br>
        <!-- 修改商品按鈕 -->
        <button id="updateProductBtn" type="submit">修改商品</button>
    </form>
	</div>
	
	<!-- 引入 JavaScript 腳本 -->
		    <script src="../js/scripts.js"></script>
		    <script src="../js/utils.js"></script>
			
			

    <script>
		$(document).ready(function() {
		    // 解析URL以獲取商品ID
		    function getProductIdFromUrl() {
		        const params = new URLSearchParams(window.location.search);
		        return params.get('productId');
		    }
		
		    // 加載商品詳細資料並填充表單
		    function fetchProductDetails() {
		        const productId = getProductIdFromUrl();
		        if (!productId) {
		            alert('商品ID未提供！');
		            return;
		        }
		
		        $.ajax({
		            url: `/api/products/${productId}`,
		            type: 'GET',
		            success: function(product) {
		                $('#productId').val(product.productId);
		                $('#productName').val(product.productName);
		                $('#productDescription').val(product.productDescription);
		                $('#productPrice').val(product.productPrice);
		                $('#productStock').val(product.productStock);
		                $('#productTargetAudience').val(product.productTargetAudience);
		            },
		            error: function(xhr) {
		                alert('加載商品資料失敗: ' + xhr.status);
		            }
		        });
		    }
		
		    // 註冊表單提交事件
		    $('#updateProductForm').on('submit', function(event) {
		        event.preventDefault();
		        const productId = $('#productId').val();
		
		        const productData = {
		            productId: $('#productId').val(),
		            productName: $('#productName').val(),
		            productDescription: $('#productDescription').val(),
		            productPrice: parseInt($('#productPrice').val(), 10),
		            productStock: parseInt($('#productStock').val(), 10),
		            productTargetAudience: $('#productTargetAudience').val(),
		        };
		
		        // 使用 jQuery AJAX 發送更新請求
		        $.ajax({
		            url: `/api/products/${productId}`,
		            type: 'PUT',
		            contentType: 'application/json',
		            data: JSON.stringify(productData),
		            success: function(data) {
		                alert('商品修改成功');
		                console.log('Success:', data);
						   // 修改完回商品首頁
						window.location.href = "/mall/index"; 
		            },
		            error: function(xhr, status, error) {
		                alert('商品修改失敗: ' + xhr.status);
		                console.error('Error:', xhr.responseText);
		            }
		        });
		    });
		
		    fetchProductDetails(); // 僅需呼叫一次
		});
    </script>
	
	</script>
		<!-- 動態加載Header -->
		    <script>
		        fetch("/html/backtest.html")
		            .then(response => {
		                if (response.ok) {
		                    return response.text();
		                }
		            }).then(data => {
		                document.querySelector('#header').innerHTML = data;
		            })
		    </script>
</body>

</html>