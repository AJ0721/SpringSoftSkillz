<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>課程訂單</title>
    <script src="https://kit.fontawesome.com/8f15672443.js" crossorigin="anonymous"></script>
    <script src="/courseorder/js/fetch.js"></script>
    <script src="/courseorder/js/courseorder.js"></script>
    <link rel="stylesheet" href="/courseorder/css/reset.css">
    <link rel="stylesheet" href="/courseorder/css/bar.css">
    <link rel="stylesheet" href="/courseorder/css/tablefotcart.css">

</head>
<style>
    .header {
        background-image: url(/img/xxx.jpg);
        max-width: 100%;
        height: 420px;
        background-repeat: no-repeat;
        background-size: cover;
        background-position: center center;

        .text {
            text-align: center;
        }
    }

    button {
        background-color: #ff8c00;
        color: #fff;
        border: none;
        padding: 10px 20px;
        cursor: pointer;
        font-size: 16px;
        border-radius: 5px;
    }

    button:hover {
        background-color: #ffad5c;
    }
</style>

<body>
    <div id="fetch"></div>
    <div>
        <table border="1" align="center">
            <thead>
                <tr>
                    <th>訂單編號</th>
                    <th>總金額</th>
                    <th>購買時間</th>
                    <th>付款期限</th>
                    <th>付款方式</th>
                    <th>訂單狀態</th>
                    <th>詳細資料</th>
                    <th>操作</th>
                    <th></th>
                    <th style="display: none">操作</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>

    <script>
        fetch("/courseorder/html/testiframe3.html")
            .then(response => {
                if (response.ok) {
                    return response.text();
                }
            }).then(data => {
                document.querySelector('#fetch').innerHTML = data;
            })
        // window.onload = () => {
        //     const orders = sessionStorage.getItem("orders");
        //     if (orders) {
        //         appendorder(JSON.parse(orders));
        //     } else {
        //         getAllOrders();
        //     }
        // }

        // function getAllOrders() {
        //     fetch("/courseorder")
        //         .then(response => {
        //             console.log(response);
        //             if (response.ok) {
        //                 return response.json();
        //             }
        //         }).then(data => {
        //             let orders = JSON.stringify(data);
        //             sessionStorage.setItem("orders", orders)
        //             appendorder(data);
        //         })
        // }



        // function cancel(button) {
        //     let orderID = button.parentNode.parentNode.querySelector(".orderID").textContent;
        //     let data = {
        //         orderID: orderID
        //     }
        //     fetch("/courseorder/" + orderID, {
        //         method: "put",
        //         headers: { "Content-Type": "application/json" },
        //     }).then(response => {
        //         if (response.ok) {
        //             getAllOrders();

        //         }
        //     })
        //         .catch(error => {
        //             console.log(error);
        //         });
        // };

        // function appendorder(data) {
        //     let tbody = document.querySelector("tbody");
        //     tbody.innerHTML = "";
        //     console.log(data);
        //     for (let key in data) {
        //         let row = document.createElement("tr");
        //         let date = new Date(data[key].orderDate);
        //         let date2 = new Date(data[key].cancelDate);
        //         let isPaid = data[key].orderStatus !== '未付款';

        //         row.innerHTML = "<td class='orderID'>" + data[key].orderID + "</td>"
        //             + "<td>" + data[key].orderPrice + "</td>"
        //             + "<td>" + date.toLocaleString('sv') + "</td>"
        //             + "<td>" + date2.toLocaleString('sv') + "</td>"
        //             + "<td>" + data[key].paymentMethod + "</td>"
        //             + "<td>" + data[key].orderStatus + "</td>"
        //             + "<td><a href='/courseorder/" + data[key].orderID + "'>詳細</a></td>"
        //             + "<td><button class='cancel' onclick='cancel(this)'>取消</button></td>"
        //             + "<td><button class='pay' onclick='toPayPage(this)' " + (isPaid ? "hidden " : "") + ">付款</button></td>";
        //         tbody.appendChild(row);
        //     }
        // }






        function toPayPage(button) {
            let orderID = button.parentNode.parentNode.querySelector(".orderID").textContent;
            window.location.href = "/courseorder/pay?orderID=" + orderID;
        }

        // function toPay(button) {
        //     let orderID = button.parentNode.parentNode.querySelector(".orderID").textContent;

        //     fetch("/LinePayReqAfter/" + orderID, {
        //         method: "post",
        //         headers: { "Content-Type": "application/json" },
        //     }).then((respone) => {
        //         if (respone.ok) {
        //             console.log(respone)
        //             return respone.json()
        //         } else {
        //             console.error("Failed to remove item from cart. Status:", response.status);
        //         }
        //     }).then(data => {
        //         window.location.href = data;
        //     })
        //         .catch(error => {
        //             console.error("Error removing item from cart:", error);
        //         });
        // }    
    </script>
</body>

</html>